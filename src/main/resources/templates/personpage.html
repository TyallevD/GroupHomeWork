<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>

    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="../static/css/style.css">

</head>

<body>
<!-- –ü—Ä–æ—Ñ–∏–ª—å -->
<div class="person-page-container">
    <div class="person-page-header">
        <div class="header-info" th:if="${user != null}">
            <p><strong>–õ–æ–≥–∏–Ω:</strong> <span th:text="${user.username}">user</span></p>
        </div>

        <div class="header-info">
            <p><strong>–†–æ–ª—å:</strong>
                <span th:text="${user.getRole() == 'ROLE_ADMIN'? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}"></span>
            </p>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="person-button-group">

            <a th:if="${user.getRole()== 'ROLE_ADMIN'}" class="register-btn" th:href="@{/admin/dashboard}">–ü–∞–Ω–µ–ª—å
                –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a>

            <form class="person-button-group" th:action="@{/logout}" method="post">
                <!--                <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}"-->
                <!--                       th:value="${_csrf.token}"/>-->
                <button type="submit" class="back-btn">–í—ã–π—Ç–∏</button>
            </form>
        </div>
    </div>
    <div class="person-tasks-container">
        <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
        <div class="welcome">
        <h2 th:text="${welcomeMessage}"></h2>
            <h3>–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h3>
            <button class="add-task" id="openAddTaskModal">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
        </div>

        <!-- –û—à–∏–±–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è -->
        <div th:if="${success}" class="alert alert-success" th:text="${success}">
        </div>
        <div th:if="${error}" class="alert alert-error" th:text="${error}">
        </div>
        <table th:if="${tasks.size()!=0}" border="1">
            <thead>
            <tr>
                <th onclick="sortTable(0)" class="title">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th onclick="sortTable(1)" class="description">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th onclick="sortTable(2)" class="completed">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</th>
                <th class="task-actions">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="t , status : ${tasks}">
                <td th:text="${t.getTitle()}"></td>
                <td th:text="${t.getDescription()}"></td>
                <td class="status-cell">
                    <span th:if="${t.isCompleted()}" class="status-completed">‚úÖ</span>
                    <span th:unless="${t.isCompleted()}" class="status-not-completed">‚ùå</span>
                </td>
                <td>
                    <div>
                        <button class="edit-btn"
                                th:data-id="${t.getId()}"
                                th:data-title="${t.getTitle()}"
                                th:data-description="${t.getDescription()}"
                                th:data-completed="${t.isCompleted()}"
                                onclick="openEditModal(this)">
                            ‚úèÔ∏è
                        </button>

                        <form onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–º–µ—Ç–∫—É?')"
                              class="delete-btn" style="display: inline"
                              th:action="@{/api/tasks/{id}(id=${t.getId()})}" method="post">
                            <input type="hidden" name="_method" value="delete">
                            <button type="submit" class="delete-btn">üóëÔ∏è</button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <h3 th:unless="${tasks.size()!=0}">–ó–∞–º–µ—Ç–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é!</h3>
    </div>
</div>

<!--    –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏-->
<div id="addTaskModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É</h3>

        <form id="addTaskForm" th:action="@{/api/tasks}" method="post">
            <div class="form-group">
                <label for="taskTitle">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                <input type="text" id="taskTitle" name="title" maxlength="50" required
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–º–∞–∫—Å. 50 —Å–∏–º–≤–æ–ª–æ–≤)">
                <span class="char-count"><span id="titleCount">0</span>/50</span>
            </div>

            <div class="form-group">
                <label for="taskDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="taskDescription" name="description" rows="6" maxlength="255"
                          placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏..." style="resize: both;"></textarea>
            </div>

            <div class="form-buttons">
                <button type="submit" class="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

<!--    –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏-->
<div id="editTaskModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫—É</h3>

        <form id="editTaskForm" method="post">
            <input type="hidden" id="editTaskId" name="id">
            <input type="hidden" name="_method" value="put">

            <div class="form-group">
                <label for="editTaskTitle">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                <input type="text" id="editTaskTitle" name="title" maxlength="50" required
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–º–∞–∫—Å. 50 —Å–∏–º–≤–æ–ª–æ–≤)">
            </div>

            <div class="form-group">
                <label for="editTaskDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="editTaskDescription" name="description" rows="6" maxlength="255"
                          placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏..." style="resize: both;"></textarea>
            </div>

            <div class="form-group">
                <label for="editTaskCompleted">
                    <input type="checkbox" id="editTaskCompleted" name="completed">
                    –í—ã–ø–æ–ª–Ω–µ–Ω–æ
                </label>
            </div>

            <div class="form-buttons">
                <button type="submit" class="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <button type="button" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

<script th:src="@{/script/script.js}"></script>
</body>

</html>